<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kh.finalproject.admin.model.mapper.AdminMapper">
  
    <resultMap id="adminMemberMap" type="com.kh.finalproject.dto.Member">
        <id property="memberNo" column="MEMBER_NO" />
        <result property="memberEmail" column="MEMBER_EMAIL" />
        <result property="memberPw" column="MEMBER_PW" />
        <result property="memberNickname" column="MEMBER_NICKNAME" />
        <result property="memberTel" column="MEMBER_TEL" />
        <result property="memberAddr" column="MEMBER_ADDR" />
        <result property="profileImg" column="PROFILE_IMG" />
        <result property="enrollDate" column="ENROLL_DATE" />
        <result property="memberDelFl" column="MEMBER_DEL_FL" />
        <result property="authority" column="AUTHORITY" />
    </resultMap>

	<select id="login" resultMap="adminMemberMap">
		SELECT 
            MEMBER_NO,
            MEMBER_EMAIL, 
            MEMBER_PW,
            MEMBER_NICKNAME, 
            MEMBER_TEL,
            AUTHORITY,
            MEMBER_DEL_FL
		FROM "MEMBER"
		WHERE MEMBER_EMAIL = #{memberEmail}
		AND AUTHORITY = 2
		AND MEMBER_DEL_FL = 'N'
	</select>
	
	<select id="checkEmail">
		SELECT COUNT(*) FROM "MEMBER"
		WHERE MEMBER_EMAIL = #{memberEmail}
	</select>
	
	<insert id="createAdminAccount">
		INSERT INTO "MEMBER"
		VALUES(SEQ_MEMBER_NO.NEXTVAL,
		 #{memberEmail},
		 #{memberPw},
		 #{memberNickname},
		 #{memberTel},
		 NULL,
		 NULL,
		 DEFAULT,
		 DEFAULT,
		 2
		)
	</insert>
	
	<select id="adminAccountList" resultMap="adminMemberMap">
		SELECT MEMBER_NO, MEMBER_EMAIL,
		MEMBER_NICKNAME, MEMBER_TEL
		FROM "MEMBER"
		WHERE AUTHORITY = 2
		AND MEMBER_DEL_FL = 'N'
	</select>
	
   <select id="maxReadCount" resultType="com.kh.finalproject.dto.Board">
    SELECT *
    FROM (
        SELECT 
            BT.BOARD_NAME AS boardName, 
            B.BOARD_NO AS boardNo, 
            B.BOARD_TITLE AS boardTitle, 
            M.MEMBER_NICKNAME AS memberNickname, 
            B.READ_COUNT AS readCount
        FROM "BOARD" B
        JOIN "MEMBER" M ON (B.MEMBER_NO = M.MEMBER_NO)
        JOIN "BOARD_TYPE" BT ON (B.BOARD_CODE = BT.BOARD_CODE)
        ORDER BY B.READ_COUNT DESC, B.BOARD_NO DESC
    )
    WHERE ROWNUM = 1
</select>
	
	<select id="selectWithdrawnMemberList" resultMap="adminMemberMap">
		SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NICKNAME
		FROM "MEMBER"
		WHERE MEMBER_DEL_FL = 'Y'
		ORDER BY MEMBER_NO DESC
	</select>
	
	<update id="restoreMember">
		UPDATE "MEMBER" SET
		MEMBER_DEL_FL = 'N'
		WHERE MEMBER_NO = #{memberNo}
		AND MEMBER_DEL_FL = 'Y'
	</update>

</mapper>